<!--prompt/templates/prompt/components-->
{% load widget_tweaks %}

<h2 class="text-xl font-semibold mb-8">Record Progress Session</h2>
<form method="post" action="{% url 'prompt:writing_progress' %}">
  {% csrf_token %}
  
  <div class="space-y-4 max-w-2xl mx-auto">
    <!-- Goal -->
    <div>
      <label for="{{ session_form.goal.id_for_label }}" class="block text-md px-4 font-medium mb-1">
        Which goal is this for?
      </label>
      <select name="goal" id="id_goal" class="w-full h-12 rounded-md border border-gray-300 shadow-sm focus:ring-2 focus:ring-teal-500 px-4">
  <option value="">---------</option>
  {% for goal in session_form.fields.goal.queryset %}
    <option value="{{ goal.id }}" data-goal-type="{{ goal.goal_type }}"
      {% if session_form.initial.goal and session_form.initial.goal.id == goal.id %}
        selected
      {% endif %}
    >{{ goal }}</option>
  {% endfor %}
</select>
      {% if session_form.goal.errors %}
        <p class="mt-1 text-sm text-red-600">{{ session_form.goal.errors.0 }}</p>
      {% endif %}
    </div>
    <!-- Date -->
    <div>
      <label for="{{ session_form.date.id_for_label }}" class="block text-md  px-4 font-medium mb-1">Date</label>
      {{ session_form.date|add_class:"w-full mt-2 h-12 rounded-md border border-gray-300 shadow-sm focus:ring-2 focus:ring-teal-500 px-4" }}
      {% if session_form.date.errors %}
        <p class="mt-1 text-sm text-red-600">{{ session_form.date.errors.0 }}</p>
      {% endif %}
    </div>

    <!-- Minutes -->
    <div>
      <small id="minutes-help" class="text-gray-500">
        This field is required for time-based goals only.
      </small>
      <label for="{{ session_form.minutes_spent.id_for_label }}" class="block text-md  font-medium mb-1">Minutes Spent</label>
      {{ session_form.minutes_spent|add_class:"w-full h-12 rounded-md border border-gray-300 shadow-sm focus:ring-2 focus:ring-teal-500 px-4" }}
      {% if session_form.minutes_spent.errors %}
        <p class="mt-1 text-sm text-red-600">{{ session_form.minutes_spent.errors.0 }}</p>
      {% endif %}
    </div>

    <!-- Word count -->
    <div>
      <label for="{{ session_form.word_count.id_for_label }}" class="block text-md  px-4 font-medium mb-1">Word Count (Optional)</label>
      {{ session_form.word_count|add_class:"w-full h-12 rounded-md border border-gray-300 shadow-sm focus:ring-2 focus:ring-teal-500 px-4" }}
      {% if session_form.word_count.errors %}
        <p class="mt-1 text-sm text-red-600">{{ session_form.word_count.errors.0 }}</p>
      {% endif %}
    </div>

    <!-- Mood -->
    <div>
      <label for="{{ session_form.mood.id_for_label }}" class="block text-md  px-4 font-medium mb-1">How do you feel about what you accomplished?</label>
      {{ session_form.mood|add_class:"w-full h-12 rounded-md border border-gray-300 shadow-sm focus:ring-2 focus:ring-teal-500 px-4" }}
      {% if session_form.mood.errors %}
        <p class="mt-1 text-sm text-red-600">{{ session_form.mood.errors.0 }}</p>
      {% endif %}
    </div>

    <!-- Notes on what was accomplished -->
    <div>
      <label for="{{ session_form.prompt_used.id_for_label }}" class="block text-md  px-4 font-medium mb-1">Notes on what you accomplished.</label>
      {{ session_form.prompt_used|add_class:"w-full h-80 rounded-md border border-gray-300 shadow-sm focus:ring-2 focus:ring-teal-500 px-4" }}
      {% if session_form.prompt_used.errors %}
        <p class="mt-1 text-sm text-red-600">{{ session_form.prompt_used.errors.0 }}</p>
      {% endif %}
    </div>

    <!-- Notes -->
    <div>
      <label for="{{ session_form.notes.id_for_label }}" class="block text-md  px-4 font-medium mb-1">Additional Notes (Optional)</label>
      {{ session_form.notes|add_class:"w-full min-h-[8rem] px-3 py-2 rounded-md border border-gray-300 shadow-sm focus:ring-2 focus:ring-teal-500 px-4" }}
      {% if session_form.notes.errors %}
        <p class="mt-1 text-sm text-red-600">{{ session_form.notes.errors.0 }}</p>
      {% endif %}
    </div>

    <!-- Submit -->
    <div class="flex justify-end">
      <button type="submit" class="bg-teal-700 hover:bg-teal-800 text-white font-medium py-2 px-4 rounded-md transition duration-200">
        Save Session
      </button>
    </div>
  </div>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const goalSelect = document.getElementById("id_goal");
  const minutesField = document.getElementById("id_minutes_spent");
  const minutesHelp = document.getElementById("minutes-help");

  function toggleMinutesField() {
    const selectedOption = goalSelect.options[goalSelect.selectedIndex];
    const goalType = selectedOption?.getAttribute("data-goal-type");

    if (goalType === "sessions") {
      minutesField.value = "";
      minutesField.disabled = true;
      if (minutesHelp) {
        minutesHelp.textContent = "Not required for this goal type.";
      }
    } else {
      minutesField.disabled = false;
      if (minutesHelp) {
        minutesHelp.textContent = "This field is required for time-based goals only.";
      }
    }
  }

  if (goalSelect && minutesField) {
    toggleMinutesField(); // Run on page load
    goalSelect.addEventListener("change", toggleMinutesField);
  }
});
</script>
</form>
